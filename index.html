<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上海NEBS学生论坛</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind 配置
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1', // 主色调：靛蓝色
                        confession: '#EC4899', // 表白板块：粉色
                        complaint: '#EF4444',  // 吐槽板块：红色
                        question: '#3B82F6',   // 提问板块：蓝色
                        light: '#F8FAFC',
                        dark: '#1E293B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary text-white px-4 py-2 rounded-lg transition-all duration-300 hover:bg-primary/90 focus:ring-2 focus:ring-primary/50 focus:outline-none;
            }
            .btn-secondary {
                @apply bg-white text-primary border border-primary px-4 py-2 rounded-lg transition transition-all duration-300 hover:bg-primary/5 focus:ring-2 focus:ring-primary/50 focus:outline-none;
            }
            .section-indicator {
                @apply w-3 h-3 rounded-full inline inline-block mr-2;
            }
            .image-preview-container {
                @apply grid grid-cols-3 gap-3 mt-3;
            }
            .image-preview {
                @apply relative relative aspect-square bg-gray-100 rounded-md overflow-hidden;
            }
            .image-preview img {
                @apply w-full h-full object-cover;
            }
            .remove-image {
                @apply absolute top-1 right-1 bg-red-500 text-white px-2 py-1 rounded-full flex flex items-center justify-center justify-center text-xs cursor-pointer opacity-70 hover:opacity-100 transition-opacity;
            }
            .captcha-container {
                @apply flex items-center gap-3;
            }
            .captcha-image {
                @apply bg-gray-100 px-3 py-2 rounded border border-gray-300 text-lg font-bold tracking-widest;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-dark min-h-screen-screen flex flex flex-col">
    <!-- 导航栏 -->
    <header id="navbar" class="bg-white shadow-sm fixed w-full z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <div class="bg-primary text-white p-2 rounded-lg">
                    <i class="fa fa-comments text-xl"></i>
                </div>
                <h1 class="text-xl font-bold text-primary">上海NEBS学生论坛</h1>
            </a>
            
            <!-- 桌面导航 -->
            <nav class="hidden md:flex items-center space-x-8">
                <a href="#home" class="nav-link font-medium hover:text-primary transition-colors">首页</a>
                <a href="#forum" class="nav-link font-medium hover:text-primary transition-colors">论坛板块</a>
                <a href="#submit" class="nav-link font-medium hover:text-primary transition-colors">发布内容</a>
                <div id="userMenu" class="flex items-center space-x-4">
                    <button id="loginBtn" class="btn-secondary hidden">登录</button>
                    <button id="registerBtn" class="btn-primary hidden">注册</button>
                    <div id="userDropdown" class="relative hidden">
                        <button id="userBtn" class="flex items-center space-x-2 focus:outline-none">
                            <img id="desktopAvatar" src="https://picsum.photos/id/64/40/40" alt="用户头像" class="w-8 h-8 rounded-full object-cover border-2 border-primary">
                            <span id="usernameDisplay" class="font-medium"></span>
                            <i class="fa fa-caret-down text-sm"></i>
                        </button>
                        <div id="dropdownMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-10 hidden">
                            <a href="#profile" class="dropdown-item block px-4 py-2 hover:bg-gray-100 transition-colors">个人资料</a>
                            <a href="#mySubmissions" class="dropdown-item block px-4 py-2 hover:bg-gray-100 transition-colors">我的发布</a>
                            <a href="#adminPanel" id="adminLink" class="dropdown-item block px-4 py-2 hover:bg-gray-100 transition-colors hidden">审核管理</a>
                            <div class="border-t border-gray-200 my-1"></div>
                            <a href="#" id="logoutBtn" class="block px-4 py-2 hover:bg-gray-100 transition-colors text-red-500">退出登录</a>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- 移动端菜单按钮 -->
            <button id="mobileMenuBtn" class="md:hidden text-dark focus:outline-none">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobileMenu" class="md:hidden bg-white shadow-md absolute w-full left-0 top-full py-4 px-6 hidden">
            <nav class="flex flex-col space-y-4">
                <a href="#home" class="mobile-nav-link font-medium hover:text-primary transition-colors py-2">首页</a>
                <a href="#forum" class="mobile-nav-link font-medium hover:text-primary transition-colors py-2">论坛板块</a>
                <a href="#submit" class="mobile-nav-link font-medium hover:text-primary transition-colors py-2">发布内容</a>
                <div class="flex flex-col space-y-3 pt-2 border-t border-gray-100">
                    <button id="mobileLoginBtn" class="btn-secondary">登录</button>
                    <button id="mobileRegisterBtn" class="btn-primary">注册</button>
                    <div id="mobileUserMenu" class="hidden">
                        <div class="flex items-center space-x-3 mb-3">
                            <img id="mobileAvatar" src="https://picsum.photos/id/64/40/40" alt="用户头像" class="w-10 h-10 rounded-full object-cover border-2 border-primary">
                            <span id="mobileUsername" class="font-medium"></span>
                        </div>
                        <a href="#profile" class="mobile-dropdown-item block py-2 hover:text-primary transition-colors">个人资料</a>
                        <a href="#mySubmissions" class="mobile-dropdown-item block py-2 hover:text-primary transition-colors">我的发布</a>
                        <a href="#adminPanel" id="mobileAdminLink" class="mobile-dropdown-item block py-2 hover:text-primary transition-colors hidden">审核管理</a>
                        <a href="#" id="mobileLogoutBtn" class="block py-2 text-red-500 hover:text-red-600 transition-colors">退出登录</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow pt-16">
        <!-- 首页英雄区 -->
        <section id="home" class="bg-gradient-to-br from-primary/90 to-primary py-20 md:py-32">
            <div class="container mx-auto px-4 text-center text-white">
                <h2 class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-6 text-shadow leading-tight">
                    上海NEBS学生论坛
                </h2>
                <p class="text-[clamp(1rem,2vw,1.25rem)] max-w-2xl mx-auto mb-10 text-white/90">
                    属于NEBS学生的交流空间，在这里可以自由表达，分享校园生活的点滴
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#submit" class="bg-white text-primary px-8 py-3 rounded-lg font-semibold transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                        发布内容
                    </a>
                    <a href="#forum" class="bg-transparent border-2 border-white text-white px-8 py-3 rounded-lg font-semibold transition-all duration-300 hover:bg-white/10 hover:-translate-y-1">
                        浏览论坛
                    </a>
                </div>
            </div>
        </section>

        <!-- 板块介绍 -->
        <section class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-center mb-16">论坛板块</h2>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-light rounded-xl p-8 text-center card-hover border-t-4 border-confession">
                        <div class="w-16 h-16 bg-confession/10 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fa fa-heart text-confession text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-4 flex items-center justify-center">
                            <span class="section-indicator bg-confession"></span>表白墙
                        </h3>
                        <p class="text-neutral">
                            勇敢表达你的心意，向心仪的TA传递真挚情感，支持匿名发布
                        </p>
                        <a href="#forum" class="mt-6 inline-block text-confession hover:underline font-medium">
                            进入板块 <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                    
                    <div class="bg-light rounded-xl p-8 text-center card-hover border-t-4 border-complaint">
                        <div class="w-16 h-16 bg-complaint/10 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fa fa-bullhorn text-complaint text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-4 flex items-center justify-center">
                            <span class="section-indicator bg-complaint"></span>吐槽区
                        </h3>
                        <p class="text-neutral">
                            分享你的小烦恼，释放压力，但请保持文明用语，理性表达
                        </p>
                        <a href="#forum" class="mt-6 inline-block text-complaint hover:underline font-medium">
                            进入板块 <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                    
                    <div class="bg-light rounded-xl p-8 text-center card-hover border-t-4 border-question">
                        <div class="w-16 h-16 bg-question/10 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fa fa-question-circle text-question text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-4 flex items-center justify-center">
                            <span class="section-indicator bg-question"></span>提问区
                        </h3>
                        <p class="text-neutral">
                            关于学习、活动或校园生活的疑问，在这里寻找答案和建议
                        </p>
                        <a href="#forum" class="mt-6 inline-block text-question hover:underline font-medium">
                            进入板块 <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 论坛区域 -->
        <section id="forum" class="py-16 bg-gray-50">
            <div class="container mx-auto px-4">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">论坛内容</h2>
                
                <!-- 板块切换 -->
                <div class="flex flex-wrap justify-center gap-4 mb-10">
                    <button id="allPostsBtn" class="px-6 py-2 rounded-full bg-primary text-white text-sm flex items-center">
                        <i class="fa fa-th-large mr-2"></i> 全部内容
                    </button>
                    <button id="confessionBtn" class="px-6 py-2 rounded-full bg-white text-dark border border-gray-200 text-sm flex items-center hover:border-confession hover:text-confession transition-colors">
                        <span class="section-indicator bg-confession"></span> 表白墙
                    </button>
                    <button id="complaintBtn" class="px-6 py-2 rounded-full bg-white text-dark border border-gray-200 text-sm flex items-center hover:border-complaint hover:text-complaint transition-colors">
                        <span class="section-indicator bg-complaint"></span> 吐槽区
                    </button>
                    <button id="questionBtn" class="px-6 py-2 rounded-full bg-white text-dark border border-gray-200 text-sm flex items-center hover:border-question hover:text-question transition-colors">
                        <span class="section-indicator bg-question"></span> 提问区
                    </button>
                </div>

                <div id="postsContainer" class="space-y-6">
                    <!-- 帖子会通过JavaScript动态生成 -->
                    <!-- 加载状态 -->
                    <div id="loadingPosts" class="py-10 text-center">
                        <i class="fa fa-spinner fa-spin text-primary text-2xl"></i>
                        <p class="mt-3 text-neutral">加载内容中...</p>
                    </div>
                    
                    <!-- 空状态 -->
                    <div id="noPosts" class="hidden py-20 text-center">
                        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fa fa-file-text-o text-3xl text-gray-400"></i>
                        </div>
                        <h3 class="text-xl font-medium mb-2">暂无内容</h3>
                        <p class="text-neutral mb-6">目前还没有发布的内容，成为第一个分享的人吧！</p>
                        <a href="#submit" class="btn-primary inline-flex items-center">
                            <i class="fa fa-pencil mr-2"></i> 发布第一条内容
                        </a>
                    </div>
                </div>

                <div class="mt-10 text-center">
                    <button id="loadMoreBtn" class="btn-secondary inline-flex items-center">
                        <i class="fa fa-refresh mr-2"></i> 加载更多
                    </button>
                </div>
            </div>
        </section>

        <!-- 投稿区域 -->
        <section id="submit" class="py-16 bg-white">
            <div class="container mx-auto px-4 max-w-3xl">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">发布内容</h2>
                
                <div id="loginPrompt" class="bg-blue-50 border border-blue-100 rounded-xl p-6 text-center mb-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-user-circle text-blue-500 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">请先登录</h3>
                    <p class="text-blue-700 mb-6">登录后才能发布内容，所有内容将经过审核后发布</p>
                    <button id="submitLoginBtn" class="btn-primary">立即登录</button>
                </div>

                <form id="submissionForm" class="hidden bg-light rounded-xl p-6 md:p-8 shadow-sm">
                    <div class="mb-6">
                        <label for="submissionTitle" class="block text-sm font-medium mb-2">标题</label>
                        <input type="text" id="submissionTitle" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入标题" required>
                    </div>
                    
                    <div class="mb-6">
                        <label for="submissionCategory" class="block text-sm font-medium mb-2">板块</label>
                        <select id="submissionCategory" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors">
                            <option value="confession">表白墙</option>
                            <option value="complaint">吐槽区</option>
                            <option value="question">提问区</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label for="submissionContent" class="block text-sm font-medium mb-2">内容</label>
                        <textarea id="submissionContent" rows="6" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors resize-none" placeholder="请输入你想分享的内容..." required></textarea>
                    </div>
                    
                    <!-- 图片上传区域 -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">上传图片（可选）</label>
                        <div class="flex items-center justify-center w-full">
                            <label for="imageUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <i class="fa fa-cloud-upload text-2xl text-gray-400 mb-2"></i>
                                    <p class="mb-1 text-sm text-gray-500"><span class="font-semibold">点击上传</span> 或拖放图片</p>
                                    <p class="text-xs text-gray-500">支持 JPG, PNG, GIF (最大 5MB)</p>
                                </div>
                                <input id="imageUpload" type="file" class="hidden" accept="image/*" multiple />
                            </label>
                        </div>
                        
                        <!-- 图片预览区域 -->
                        <div id="imagePreviewContainer" class="image-preview-container"></div>
                    </div>
                    
                    <div class="mb-8">
                        <label class="flex items-center">
                            <input type="checkbox" id="anonymousRequest" class="w-5 h-5 text-primary focus:ring-primary/50 border-gray-300 rounded">
                            <span class="ml-2 text-sm">申请匿名发布（管理员将根据此选项决定是否匿名）</span>
                        </label>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" class="btn-primary inline-flex items-center">
                            <i class="fa fa-paper-plane mr-2"></i> 提交发布
                        </button>
                    </div>
                </form>

                <!-- 投稿成功提示 -->
                <div id="submissionSuccess" class="hidden bg-green-50 border border-green-100 rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-check text-green-500 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">发布成功！</h3>
                    <p class="text-green-700 mb-6">你的内容已提交，将在审核通过后发布</p>
                    <button id="submitAnotherBtn" class="btn-secondary">再发布一条</button>
                </div>
            </div>
        </section>

        <!-- 我的发布 -->
        <section id="mySubmissions" class="py-16 bg-gray-50 hidden">
            <div class="container mx-auto px-4 max-w-4xl">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">我的发布</h2>
                
                <div id="submissionsLoginPrompt" class="bg-blue-50 border border-blue-100 rounded-xl p-6 text-center mb-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-user-circle text-blue-500 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">请先登录</h3>
                    <p class="text-blue-700 mb-6">登录后查看你的发布记录和状态</p>
                    <button id="submissionsLoginBtn" class="btn-primary">立即登录</button>
                </div>

                <div id="mySubmissionsContainer" class="space-y-6 hidden">
                    <!-- 发布记录会通过JavaScript动态生成 -->
                    <div id="noSubmissions" class="py-20 text-center">
                        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fa fa-pencil text-3xl text-gray-400"></i>
                        </div>
                        <h3 class="text-xl font-medium mb-2">暂无发布</h3>
                        <p class="text-neutral mb-6">你还没有任何发布记录，快去分享你的想法吧！</p>
                        <a href="#submit" class="btn-primary inline-flex items-center">
                            <i class="fa fa-pencil mr-2"></i> 立即发布
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 审核管理面板 -->
        <section id="adminPanel" class="py-16 bg-gray-50 hidden">
            <div class="container mx-auto px-4 max-w-4xl">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">审核管理</h2>
                
                <div id="adminLoginPrompt" class="bg-blue-50 border border-blue-100 rounded-xl p-6 text-center mb-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-lock text-blue-500 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">请先登录管理员账号</h3>
                    <p class="text-blue-700 mb-6">只有管理员可以访问审核管理面板</p>
                    <button id="adminLoginBtn" class="btn-primary">管理员登录</button>
                </div>

                <div id="adminPanelContainer" class="hidden">
                    <div class="flex flex-wrap gap-3 mb-8">
                        <button id="pendingReviewsBtn" class="px-4 py-2 rounded-full bg-primary text-white text-sm">待审核</button>
                        <button id="approvedBtn" class="px-4 py-2 rounded-full bg-white text-dark border border-gray-200 text-sm hover:border-primary hover:text-primary transition-colors">已通过</button>
                        <button id="rejectedBtn" class="px-4 py-2 rounded-full bg-white text-dark border border-gray-200 text-sm hover:border-primary hover:text-primary transition-colors">已拒绝</button>
                    </div>

                    <div id="pendingReviewsContainer" class="space-y-6">
                        <!-- 待审核内容会通过JavaScript动态生成 -->
                        <div id="noPendingReviews" class="py-20 text-center">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fa fa-check-circle text-3xl text-gray-400"></i>
                            </div>
                            <h3 class="text-xl font-medium mb-2">暂无待审核内容</h3>
                            <p class="text-neutral">所有提交的内容都已审核完毕</p>
                        </div>
                    </div>

                    <div id="approvedContainer" class="space-y-6 hidden">
                        <!-- 已通过内容会通过JavaScript动态生成 -->
                        <div id="noApproved" class="py-20 text-center">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fa fa-check-circle text-3xl text-gray-400"></i>
                            </div>
                            <h3 class="text-xl font-medium mb-2">暂无已通过内容</h3>
                            <p class="text-neutral">还没有通过审核的内容</p>
                        </div>
                    </div>

                    <div id="rejectedContainer" class="space-y-6 hidden">
                        <!-- 已拒绝内容会通过JavaScript动态生成 -->
                        <div id="noRejected" class="py-20 text-center">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fa fa-times-circle text-3xl text-gray-400"></i>
                            </div>
                            <h3 class="text-xl font-medium mb-2">暂无已拒绝内容</h3>
                            <p class="text-neutral">还没有拒绝审核的内容</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 个人资料 -->
        <section id="profile" class="py-16 bg-white hidden">
            <div class="container mx-auto px-4 max-w-2xl">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">个人资料</h2>
                
                <div id="profileLoginPrompt" class="bg-blue-50 border border-blue-100 rounded-xl p-6 text-center mb-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-user-circle text-blue-500 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">请先登录</h3>
                    <p class="text-blue-700 mb-6">登录后查看和编辑你的个人资料</p>
                    <button id="profileLoginBtn" class="btn-primary">立即登录</button>
                </div>

                <div id="profileContainer" class="hidden">
                    <div class="text-center mb-10">
                        <div class="relative w-32 h-32 mx-auto mb-4">
                            <img id="profileAvatar" src="https://picsum.photos/id/64/128/128" alt="用户头像" class="w-full h-full rounded-full object-cover border-4 border-primary/20">
                            <label for="avatarUpload" class="absolute bottom-0 right-0 w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center cursor-pointer hover:bg-primary/90 transition-colors">
                                <i class="fa fa-camera"></i>
                                <input id="avatarUpload" type="file" class="hidden" accept="image/*">
                            </label>
                        </div>
                        <h3 id="profileName" class="text-xl font-bold mb-1"></h3>
                        <p id="profileJoinDate" class="text-sm text-neutral"></p>
                    </div>

                    <form id="profileForm" class="bg-light rounded-xl p-6 md:p-8 shadow-sm">
                        <div class="mb-6">
                            <label for="profilePhone" class="block text-sm font-medium mb-2">手机号</label>
                            <input type="text" id="profilePhone" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-gray-100 cursor-not-allowed" readonly>
                        </div>
                        
                        <div class="mb-6">
                            <label for="editName" class="block text-sm font-medium mb-2">姓名</label>
                            <input type="text" id="editName" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors">
                        </div>
                        
                        <div class="mb-6">
                            <label for="editBio" class="block text-sm font-medium mb-2">个人简介</label>
                            <textarea id="editBio" rows="4" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors resize-none" placeholder="简单介绍一下自己吧..."></textarea>
                        </div>
                        
                        <div class="mb-6">
                            <label for="editPassword" class="block text-sm font-medium mb-2">修改密码（不修改请留空）</label>
                            <input type="password" id="editPassword" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入新密码">
                            <p class="text-xs text-neutral mt-1">密码长度至少6位</p>
                        </div>
                        
                        <div class="flex justify-end">
                            <button type="submit" class="btn-primary inline-flex items-center">
                                <i class="fa fa-save mr-2"></i> 保存修改
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-2 mb-3">
                        <div class="bg-white text-primary p-1 rounded-lg">
                            <i class="fa fa-comments"></i>
                        </div>
                        <h2 class="text-xl font-bold">上海NEBS学生论坛</h2>
                    </div>
                    <p class="text-gray-400 text-sm max-w-md">
                        为NEBS学生提供交流和分享的平台，让校园生活更加丰富多彩
                    </p>
                </div>
                
                <div class="flex flex-col items-center md:items-end">
                    <div class="flex space-x-4 mb-4">
                        <a href="#" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fa fa-weixin"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fa fa-weibo"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fa fa-envelope"></i>
                        </a>
                    </div>
                    <p class="text-gray-400 text-sm">
                        &copy; 2023 上海NEBS学生论坛 版权所有
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 登录模态框 -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4 transform transition-all scale-95 opacity-0" id="modalContent">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">登录</h3>
                    <button id="closeLoginModal" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="loginForm">
                    <div class="mb-6">
                        <label for="loginPhone" class="block text-sm font-medium mb-2">手机号</label>
                        <input type="tel" id="loginPhone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入手机号" required>
                    </div>
                    
                    <div class="mb-6">
                        <label for="loginPassword" class="block text-sm font-medium mb-2">密码</label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入密码" required>
                    </div>
                    
                    <!-- 验证码 -->
                    <div class="mb-8">
                        <label for="loginCaptcha" class="block text-sm font-medium mb-2">验证码</label>
                        <div class="captcha-container">
                            <input type="text" id="loginCaptcha" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入验证码" required>
                            <div id="loginCaptchaImage" class="captcha-image">
                                <span id="loginCaptchaCode">ABCD</span>
                                <button type="button" id="refreshLoginCaptcha" class="ml-2 text-sm text-gray-500 hover:text-primary">
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" class="w-4 h-4 text-primary focus:ring-primary/50 border-gray-300 rounded">
                            <span class="ml-2 text-sm">记住我</span>
                        </label>
                        <button type="button" id="forgotPasswordBtn" class="text-sm text-primary hover:underline">忘记密码？</button>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full mb-4">登录</button>
                    
                    <p class="text-center text-sm text-neutral">
                        还没有账号？ <button type="button" id="switchToRegister" class="text-primary hover:underline">立即注册</button>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- 注册模态框 -->
    <div id="registerModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4 transform transition-all scale-95 opacity-0" id="registerModalContent">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">注册</h3>
                    <button id="closeRegisterModal" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="registerForm">
                    <div class="mb-6">
                        <label for="registerPhone" class="block text-sm font-medium mb-2">手机号</label>
                        <input type="tel" id="registerPhone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入手机号" required>
                    </div>
                    
                    <div class="mb-6">
                        <label for="registerName" class="block text-sm font-medium mb-2">姓名</label>
                        <input type="text" id="registerName" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入姓名" required>
                    </div>
                    
                    <div class="mb-6">
                        <label for="registerPassword" class="block text-sm font-medium mb-2">密码</label>
                        <input type="password" id="registerPassword" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请设置密码（至少6位）" required>
                    </div>
                    
                    <!-- 验证码 -->
                    <div class="mb-8">
                        <label for="registerCaptcha" class="block text-sm font-medium mb-2">验证码</label>
                        <div class="captcha-container">
                            <input type="text" id="registerCaptcha" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入验证码" required>
                            <div id="registerCaptchaImage" class="captcha-image">
                                <span id="registerCaptchaCode">WXYZ</span>
                                <button type="button" id="refreshRegisterCaptcha" class="ml-2 text-sm text-gray-500 hover:text-primary">
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full mb-4">注册</button>
                    
                    <p class="text-center text-sm text-neutral">
                        已有账号？ <button type="button" id="switchToLogin" class="text-primary hover:underline">立即登录</button>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- 忘记密码模态框 -->
    <div id="forgotPasswordModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4 transform transition-all scale-95 opacity-0" id="forgotPasswordModalContent">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">找回密码</h3>
                    <button id="closeForgotPasswordModal" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="forgotPasswordForm">
                    <div class="mb-6">
                        <label for="forgotPhone" class="block text-sm font-medium mb-2">手机号</label>
                        <input type="tel" id="forgotPhone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入注册的手机号" required>
                    </div>
                    
                    <!-- 验证码 -->
                    <div class="mb-8">
                        <label for="forgotCaptcha" class="block text-sm font-medium mb-2">验证码</label>
                        <div class="captcha-container">
                            <input type="text" id="forgotCaptcha" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请输入验证码" required>
                            <div id="forgotCaptchaImage" class="captcha-image">
                                <span id="forgotCaptchaCode">PQRS</span>
                                <button type="button" id="refreshForgotCaptcha" class="ml-2 text-sm text-gray-500 hover:text-primary">
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label for="newPassword" class="block text-sm font-medium mb-2">新密码</label>
                        <input type="password" id="newPassword" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors" placeholder="请设置新密码（至少6位）" required>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full mb-4">重置密码</button>
                    
                    <p class="text-center text-sm text-neutral">
                        想起密码了？ <button type="button" id="backToLoginFromForgot" class="text-primary hover:underline">返回登录</button>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- 通知组件 -->
    <div id="notification" class="fixed bottom-6 right-6 bg-dark text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
        <i id="notificationIcon" class="fa fa-check-circle mr-3"></i>
        <span id="notificationMessage"></span>
    </div>

    <script>
        // 工具函数
        const Utils = {
            // 显示通知
            showNotification: function(message, isError = false) {
                const notification = document.getElementById('notification');
                const notificationIcon = document.getElementById('notificationIcon');
                const notificationMessage = document.getElementById('notificationMessage');
                
                notificationMessage.textContent = message;
                
                // 设置图标
                if (isError) {
                    notificationIcon.className = 'fa fa-times-circle mr-3 text-red-400';
                } else {
                    notificationIcon.className = 'fa fa-check-circle mr-3';
                }
                
                // 显示通知
                notification.classList.remove('translate-y-20', 'opacity-0');
                notification.classList.add('translate-y-0', 'opacity-100');
                
                // 3秒后隐藏
                setTimeout(() => {
                    notification.classList.remove('translate-y-0', 'opacity-100');
                    notification.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            },
            
            // 隐藏模态框
            hideModal: function(modalId) {
                const modal = document.getElementById(modalId);
                const modalContentMap = {
                    'loginModal': 'modalContent',
                    'registerModal': 'registerModalContent',
                    'forgotPasswordModal': 'forgotPasswordModalContent'
                };
                const modalContentId = modalContentMap[modalId];
                if (!modalContentId) return;
                
                const modalContent = document.getElementById(modalContentId);
                
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            },
            
            // 显示模态框
            showModal: function(modalId) {
                const modal = document.getElementById(modalId);
                const modalContentMap = {
                    'loginModal': 'modalContent',
                    'registerModal': 'registerModalContent',
                    'forgotPasswordModal': 'forgotPasswordModalContent'
                };
                const modalContentId = modalContentMap[modalId];
                if (!modalContentId) return;
                
                const modalContent = document.getElementById(modalContentId);
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            },
            
            // 清除表单
            clearForm: function(formId) {
                const form = document.getElementById(formId);
                if (form) form.reset();
            },
            
            // 生成随机ID
            generateId: function(prefix = '') {
                return prefix + Date.now() + Math.floor(Math.random() * 1000);
            },
            
            // 格式化日期
            formatDate: function(dateString) {
                const date = new Date(dateString);
                return date.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },
            
            // 检查元素是否存在
            elementExists: function(selector) {
                return document.querySelector(selector) !== null;
            },
            
            // 生成随机验证码
            generateCaptcha: function(length = 4) {
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 排除容易混淆的字符
                let captcha = '';
                for (let i = 0; i < length; i++) {
                    captcha += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return captcha;
            },
            
            // 更新验证码显示
            updateCaptcha: function(elementId, codeElementId) {
                const captcha = this.generateCaptcha();
                document.getElementById(codeElementId).textContent = captcha;
                return captcha;
            },
            
            // 验证验证码
            validateCaptcha: function(inputValue, captchaValue) {
                return inputValue.trim().toUpperCase() === captchaValue.trim().toUpperCase();
            }
        };

        // 应用数据管理
        const AppData = {
            // 初始化数据
            init: function() {
                try {
                    this.users = JSON.parse(localStorage.getItem('nebsForumUsers')) || [];
                    this.submissions = JSON.parse(localStorage.getItem('nebsForumSubmissions')) || [];
                    this.currentUser = JSON.parse(localStorage.getItem('nebsForumCurrentUser')) || null;
                    this.adminPhone = '13262666668'; // 管理员手机号
                    
                    // 确保管理员账号存在
                    this.ensureAdminExists();
                    
                    // 保存数据
                    this.saveToLocalStorage();
                } catch (error) {
                    console.error('初始化数据出错:', error);
                    // 数据损坏时重置
                    this.resetData();
                }
            },
            
            // 确保管理员账号存在
            ensureAdminExists: function() {
                const adminExists = this.users.some(u => u.phone.trim() === this.adminPhone);
                if (!adminExists) {
                    // 添加默认管理员
                    this.users.push({
                        id: 'admin1',
                        phone: this.adminPhone,
                        name: '管理员',
                        password: 'admin123', // 默认密码
                        bio: '论坛管理员',
                        avatar: 'https://picsum.photos/id/1005/100/100',
                        joinDate: new Date().toISOString().split('T')[0],
                        isAdmin: true
                    });
                } else {
                    // 确保管理员标识正确
                    const adminIndex = this.users.findIndex(u => u.phone.trim() === this.adminPhone);
                    if (adminIndex !== -1) {
                        this.users[adminIndex].isAdmin = true;
                    }
                }
            },
            
            // 重置数据（用于数据损坏时）
            resetData: function() {
                this.users = [];
                this.submissions = [];
                this.currentUser = null;
                this.ensureAdminExists();
                this.saveToLocalStorage();
                Utils.showNotification('数据已重置，请重新登录', true);
            },
            
            // 保存数据到本地存储
            saveToLocalStorage: function() {
                try {
                    localStorage.setItem('nebsForumUsers', JSON.stringify(this.users));
                    localStorage.setItem('nebsForumSubmissions', JSON.stringify(this.submissions));
                    localStorage.setItem('nebsForumCurrentUser', JSON.stringify(this.currentUser));
                } catch (error) {
                    console.error('保存数据到本地存储失败:', error);
                    Utils.showNotification('数据保存失败，请检查浏览器存储权限', true);
                }
            },
            
            // 用户注册
            register: function(userData, captchaInput, captchaCode) {
                // 验证验证码
                if (!Utils.validateCaptcha(captchaInput, captchaCode)) {
                    return { success: false, message: '验证码不正确' };
                }
                
                // 验证密码
                if (userData.password.length < 6) {
                    return { success: false, message: '密码长度不能少于6位' };
                }
                
                // 检查手机号是否已存在
                const normalizedPhone = userData.phone.trim();
                if (this.users.some(u => u.phone.trim() === normalizedPhone)) {
                    return { success: false, message: '手机号已被注册' };
                }
                
                // 创建新用户
                const newUser = {
                    id: `user${this.users.length + 1}`,
                    phone: normalizedPhone,
                    name: userData.name.trim(),
                    password: userData.password,
                    bio: '',
                    avatar: `https://picsum.photos/id/${200 + this.users.length}/100/100`,
                    joinDate: new Date().toISOString().split('T')[0],
                    isAdmin: normalizedPhone === this.adminPhone
                };
                
                this.users.push(newUser);
                this.currentUser = newUser;
                this.saveToLocalStorage();
                
                return { success: true, user: newUser };
            },
            
            // 用户登录
            login: function(phone, password, captchaInput, captchaCode) {
                try {
                    // 验证验证码
                    if (!Utils.validateCaptcha(captchaInput, captchaCode)) {
                        return { success: false, message: '验证码不正确' };
                    }
                    
                    // 去除手机号可能的空格，确保格式一致
                    const normalizedPhone = phone.trim();
                    
                    // 查找用户
                    const user = this.users.find(u => 
                        u.phone.trim() === normalizedPhone
                    );
                    
                    // 先检查用户是否存在，再验证密码
                    if (!user) {
                        return { success: false, message: '用户不存在' };
                    }
                    
                    // 严格验证密码
                    if (user.password !== password) {
                        return { success: false, message: '密码错误' };
                    }
                    
                    // 设置管理员标识
                    user.isAdmin = normalizedPhone === this.adminPhone;
                    this.currentUser = { ...user };
                    this.saveToLocalStorage();
                    return { success: true, user: this.currentUser };
                } catch (error) {
                    console.error('登录过程出错:', error);
                    return { success: false, message: '登录过程中出现错误，请重试' };
                }
            },
            
            // 忘记密码 - 重置密码
            resetPassword: function(phone, newPassword, captchaInput, captchaCode) {
                // 验证验证码
                if (!Utils.validateCaptcha(captchaInput, captchaCode)) {
                    return { success: false, message: '验证码不正确' };
                }
                
                // 验证密码
                if (newPassword.length < 6) {
                    return { success: false, message: '密码长度不能少于6位' };
                }
                
                // 查找用户
                const normalizedPhone = phone.trim();
                const userIndex = this.users.findIndex(u => u.phone.trim() === normalizedPhone);
                
                if (userIndex === -1) {
                    return { success: false, message: '该手机号未注册' };
                }
                
                // 更新密码
                this.users[userIndex].password = newPassword;
                this.saveToLocalStorage();
                
                return { success: true, message: '密码已重置，请使用新密码登录' };
            },
            
            // 用户登出
            logout: function() {
                this.currentUser = null;
                this.saveToLocalStorage();
            },
            
            // 提交内容
            submitContent: function(submissionData) {
                if (!this.currentUser) {
                    return { success: false, message: '请先登录' };
                }
                
                const newSubmission = {
                    id: `sub${this.submissions.length + 1}`,
                    title: submissionData.title.trim(),
                    category: submissionData.category,
                    content: submissionData.content.trim(),
                    images: submissionData.images || [],
                    anonymousRequest: submissionData.anonymousRequest,
                    authorId: this.currentUser.id,
                    authorName: this.currentUser.name,
                    authorPhone: this.currentUser.phone,
                    authorAvatar: this.currentUser.avatar,
                    status: 'pending', // pending, approved, rejected
                    reviewNote: '',
                    createdAt: new Date().toISOString(),
                    approvedAt: null
                };
                
                this.submissions.push(newSubmission);
                this.saveToLocalStorage();
                
                return { success: true, submission: newSubmission };
            },
            
            // 获取用户的所有投稿
            getUserSubmissions: function() {
                if (!this.currentUser) return [];
                return this.submissions.filter(sub => sub.authorId === this.currentUser.id);
            },
            
            // 获取待审核的内容
            getPendingSubmissions: function() {
                return this.submissions.filter(sub => sub.status === 'pending');
            },
            
            // 获取已通过的内容
            getApprovedSubmissions: function() {
                return this.submissions.filter(sub => sub.status === 'approved');
            },
            
            // 获取已拒绝的内容
            getRejectedSubmissions: function() {
                return this.submissions.filter(sub => sub.status === 'rejected');
            },
            
            // 审核内容
            reviewSubmission: function(submissionId, status, note = '') {
                const submission = this.submissions.find(sub => sub.id === submissionId);
                if (!submission) {
                    return { success: false, message: '内容不存在' };
                }
                
                submission.status = status;
                submission.reviewNote = note;
                submission.approvedAt = new Date().toISOString();
                this.saveToLocalStorage();
                
                return { success: true, submission: submission };
            },
            
            // 更新用户资料
            updateProfile: function(userData) {
                try {
                    if (!this.currentUser) {
                        return { success: false, message: '请先登录' };
                    }
                    
                    const userIndex = this.users.findIndex(u => u.id === this.currentUser.id);
                    if (userIndex === -1) {
                        return { success: false, message: '用户不存在' };
                    }
                    
                    // 更新姓名
                    if (userData.name) {
                        this.users[userIndex].name = userData.name.trim();
                    }
                    
                    // 更新简介
                    if (userData.bio !== undefined) {
                        this.users[userIndex].bio = userData.bio.trim();
                    }
                    
                    // 更新密码
                    if (userData.password && userData.password.length >= 6) {
                        this.users[userIndex].password = userData.password;
                    }
                    
                    // 更新头像
                    if (userData.avatar) {
                        this.users[userIndex].avatar = userData.avatar;
                    }
                    
                    // 更新当前用户
                    this.currentUser = { ...this.users[userIndex] };
                    this.saveToLocalStorage();
                    
                    return { success: true, user: this.currentUser };
                } catch (error) {
                    console.error('更新资料出错:', error);
                    return { success: false, message: '更新资料时出现错误，请重试' };
                }
            }
        };

        // 视图控制器
        const ViewController = {
            // 初始化视图
            init: function() {
                try {
                    this.updatePageState();
                    this.bindEvents();
                    this.renderPosts();
                    this.initCaptchas();
                } catch (error) {
                    console.error('初始化视图出错:', error);
                    Utils.showNotification('页面加载出错，请刷新重试', true);
                }
            },
            
            // 初始化验证码
            initCaptchas: function() {
                // 登录验证码
                if (Utils.elementExists('#loginCaptchaCode')) {
                    Utils.updateCaptcha('loginCaptchaImage', 'loginCaptchaCode');
                }
                
                // 注册验证码
                if (Utils.elementExists('#registerCaptchaCode')) {
                    Utils.updateCaptcha('registerCaptchaImage', 'registerCaptchaCode');
                }
                
                // 忘记密码验证码
                if (Utils.elementExists('#forgotCaptchaCode')) {
                    Utils.updateCaptcha('forgotCaptchaImage', 'forgotCaptchaCode');
                }
            },
            
            // 更新页面状态
            updatePageState: function() {
                try {
                    const currentUser = AppData.currentUser;
                    
                    // 更新导航栏用户菜单
                    const loginBtn = document.getElementById('loginBtn');
                    const registerBtn = document.getElementById('registerBtn');
                    const userDropdown = document.getElementById('userDropdown');
                    const usernameDisplay = document.getElementById('usernameDisplay');
                    const desktopAvatar = document.getElementById('desktopAvatar');
                    
                    // 移动端用户菜单
                    const mobileLoginBtn = document.getElementById('mobileLoginBtn');
                    const mobileRegisterBtn = document.getElementById('mobileRegisterBtn');
                    const mobileUserMenu = document.getElementById('mobileUserMenu');
                    const mobileUsername = document.getElementById('mobileUsername');
                    const mobileAvatar = document.getElementById('mobileAvatar');
                    
                    // 审核管理链接
                    const adminLink = document.getElementById('adminLink');
                    const mobileAdminLink = document.getElementById('mobileAdminLink');
                    
                    // 发布内容区域的登录提示
                    const loginPrompt = document.getElementById('loginPrompt');
                    const submissionForm = document.getElementById('submissionForm');
                    
                    // 我的发布区域的登录提示
                    const submissionsLoginPrompt = document.getElementById('submissionsLoginPrompt');
                    const mySubmissionsContainer = document.getElementById('mySubmissionsContainer');
                    
                    // 个人资料区域的登录提示
                    const profileLoginPrompt = document.getElementById('profileLoginPrompt');
                    const profileContainer = document.getElementById('profileContainer');
                    
                    if (currentUser) {
                        // 用户已登录
                        loginBtn.classList.add('hidden');
                        registerBtn.classList.add('hidden');
                        userDropdown.classList.remove('hidden');
                        usernameDisplay.textContent = currentUser.name;
                        desktopAvatar.src = currentUser.avatar || 'https://picsum.photos/id/64/40/40';
                        desktopAvatar.alt = currentUser.name + '的头像';
                        
                        mobileLoginBtn.classList.add('hidden');
                        mobileRegisterBtn.classList.add('hidden');
                        mobileUserMenu.classList.remove('hidden');
                        mobileUsername.textContent = currentUser.name;
                        mobileAvatar.src = currentUser.avatar || 'https://picsum.photos/id/64/40/40';
                        mobileAvatar.alt = currentUser.name + '的头像';
                        
                        // 显示审核管理链接（如果是管理员）
                        if (currentUser.isAdmin) {
                            adminLink.classList.remove('hidden');
                            mobileAdminLink.classList.remove('hidden');
                        } else {
                            adminLink.classList.add('hidden');
                            mobileAdminLink.classList.add('hidden');
                        }
                        
                        // 显示发布表单
                        loginPrompt.classList.add('hidden');
                        submissionForm.classList.remove('hidden');
                        
                        // 显示我的发布
                        submissionsLoginPrompt.classList.add('hidden');
                        mySubmissionsContainer.classList.remove('hidden');
                        this.renderUserSubmissions();
                        
                        // 显示个人资料
                        profileLoginPrompt.classList.add('hidden');
                        profileContainer.classList.remove('hidden');
                        this.renderProfile();
                        
                    } else {
                        // 用户未登录
                        loginBtn.classList.remove('hidden');
                        registerBtn.classList.remove('hidden');
                        userDropdown.classList.add('hidden');
                        
                        mobileLoginBtn.classList.remove('hidden');
                        mobileRegisterBtn.classList.remove('hidden');
                        mobileUserMenu.classList.add('hidden');
                        
                        // 隐藏审核管理链接
                        adminLink.classList.add('hidden');
                        mobileAdminLink.classList.add('hidden');
                        
                        // 显示登录提示
                        loginPrompt.classList.remove('hidden');
                        submissionForm.classList.add('hidden');
                        
                        // 显示我的发布登录提示
                        submissionsLoginPrompt.classList.remove('hidden');
                        mySubmissionsContainer.classList.add('hidden');
                        
                        // 显示个人资料登录提示
                        profileLoginPrompt.classList.remove('hidden');
                        profileContainer.classList.add('hidden');
                    }
                    
                    // 更新审核面板显示状态
                    this.updateAdminPanel();
                    
                    // 高亮当前页面链接
                    this.highlightCurrentPage();
                } catch (error) {
                    console.error('更新页面状态出错:', error);
                }
            },
            
            // 更新审核面板
            updateAdminPanel: function() {
                try {
                    const currentUser = AppData.currentUser;
                    const adminLoginPrompt = document.getElementById('adminLoginPrompt');
                    const adminPanelContainer = document.getElementById('adminPanelContainer');
                    
                    // 明确检查管理员身份
                    const isAdmin = currentUser && typeof currentUser.isAdmin === 'boolean' && currentUser.isAdmin;
                    
                    if (isAdmin) {
                        adminLoginPrompt.classList.add('hidden');
                        adminPanelContainer.classList.remove('hidden');
                        this.loadPendingSubmissions();
                    } else {
                        adminLoginPrompt.classList.remove('hidden');
                        adminPanelContainer.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('更新审核面板出错:', error);
                }
            },
            
            // 加载待审核内容
            loadPendingSubmissions: function() {
                try {
                    const submissions = AppData.getPendingSubmissions();
                    const container = document.getElementById('pendingReviewsContainer');
                    const noPendingReviews = document.getElementById('noPendingReviews');
                    
                    container.innerHTML = '';
                    
                    if (submissions.length === 0) {
                        noPendingReviews.classList.remove('hidden');
                        return;
                    }
                    
                    noPendingReviews.classList.add('hidden');
                    
                    submissions.forEach(submission => {
                        const categoryClass = submission.category === 'confession' ? 'bg-confession' : 
                                             submission.category === 'complaint' ? 'bg-complaint' : 'bg-question';
                        
                        const categoryText = submission.category === 'confession' ? '表白墙' : 
                                            submission.category === 'complaint' ? '吐槽区' : '提问区';
                        
                        let imagesHtml = '';
                        if (submission.images && submission.images.length > 0) {
                            imagesHtml = `
                                <div class="grid grid-cols-3 gap-2 mt-3">
                                    ${submission.images.map(img => `
                                        <div class="aspect-square bg-gray-100 rounded-md overflow-hidden">
                                            <img src="${img}" alt="发布图片" class="w-full h-full object-cover">
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                        }
                        
                        const submissionElement = document.createElement('div');
                        submissionElement.className = 'bg-white rounded-xl shadow-sm p-6';
                        submissionElement.innerHTML = `
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center">
                                    <span class="section-indicator ${categoryClass}"></span>
                                    <span class="text-sm font-medium">${categoryText}</span>
                                </div>
                                <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">待审核</span>
                            </div>
                            
                            <h3 class="text-lg font-bold mb-3">${submission.title}</h3>
                            
                            <div class="text-gray-700 mb-4">${submission.content}</div>
                            
                            ${imagesHtml}
                            
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                                    <div>
                                        作者: ${submission.authorName} (${submission.authorPhone})
                                    </div>
                                    <div>
                                        提交时间: ${Utils.formatDate(submission.createdAt)}
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="reviewNote-${submission.id}" class="block text-sm font-medium mb-2">审核备注（可选）</label>
                                    <textarea id="reviewNote-${submission.id}" rows="2" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-colors resize-none" placeholder="请输入审核备注..."></textarea>
                                </div>
                                
                                <div class="flex justify-end gap-3">
                                    <button class="reject-btn btn-secondary inline-flex items-center" data-id="${submission.id}">
                                        <i class="fa fa-times mr-2"></i> 拒绝
                                    </button>
                                    <button class="approve-btn btn-primary inline-flex items-center" data-id="${submission.id}">
                                        <i class="fa fa-check mr-2"></i> 通过并发布
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(submissionElement);
                    });
                    
                    // 绑定审核按钮事件
                    document.querySelectorAll('.approve-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const submissionId = e.currentTarget.getAttribute('data-id');
                            const note = document.getElementById(`reviewNote-${submissionId}`).value;
                            this.handleReview(submissionId, 'approved', note);
                        });
                    });
                    
                    document.querySelectorAll('.reject-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const submissionId = e.currentTarget.getAttribute('data-id');
                            const note = document.getElementById(`reviewNote-${submissionId}`).value;
                            this.handleReview(submissionId, 'rejected', note);
                        });
                    });
                } catch (error) {
                    console.error('加载待审核内容出错:', error);
                    Utils.showNotification('加载审核内容出错，请重试', true);
                }
            },
            
            // 处理审核
            handleReview: function(submissionId, status, note) {
                try {
                    const result = AppData.reviewSubmission(submissionId, status, note);
                    if (result.success) {
                        Utils.showNotification(`内容已${status === 'approved' ? '通过' : '拒绝'}`);
                        this.loadPendingSubmissions();
                        this.loadApprovedSubmissions();
                        this.loadRejectedSubmissions();
                        this.renderPosts();
                    } else {
                        Utils.showNotification(result.message, true);
                    }
                } catch (error) {
                    console.error('处理审核出错:', error);
                    Utils.showNotification('处理审核时出错，请重试', true);
                }
            },
            
            // 加载已通过内容
            loadApprovedSubmissions: function() {
                try {
                    const submissions = AppData.getApprovedSubmissions();
                    const container = document.getElementById('approvedContainer');
                    const noApproved = document.getElementById('noApproved');
                    
                    container.innerHTML = '';
                    
                    if (submissions.length === 0) {
                        noApproved.classList.remove('hidden');
                        return;
                    }
                    
                    noApproved.classList.add('hidden');
                    
                    submissions.forEach(submission => {
                        const categoryClass = submission.category === 'confession' ? 'bg-confession' : 
                                             submission.category === 'complaint' ? 'bg-complaint' : 'bg-question';
                        
                        const categoryText = submission.category === 'confession' ? '表白墙' : 
                                            submission.category === 'complaint' ? '吐槽区' : '提问区';
                        
                        let imagesHtml = '';
                        if (submission.images && submission.images.length > 0) {
                            imagesHtml = `
                                <div class="grid grid-cols-3 gap-2 mt-3">
                                    ${submission.images.map(img => `
                                        <div class="aspect-square bg-gray-100 rounded-md overflow-hidden">
                                            <img src="${img}" alt="发布图片" class="w-full h-full object-cover">
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                        }
                        
                        const submissionElement = document.createElement('div');
                        submissionElement.className = 'bg-white rounded-xl shadow-sm p-6';
                        submissionElement.innerHTML = `
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center">
                                    <span class="section-indicator ${categoryClass}"></span>
                                    <span class="text-sm font-medium">${categoryText}</span>
                                </div>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">已通过</span>
                            </div>
                            
                            <h3 class="text-lg font-bold mb-3">${submission.title}</h3>
                            
                            <div class="text-gray-700 mb-4">${submission.content}</div>
                            
                            ${imagesHtml}
                            
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <div class="flex justify-between items-center text-sm text-gray-500 mb-3">
                                    <div>
                                        作者: ${submission.authorName} ${submission.anonymousRequest ? '(匿名)' : ''}
                                    </div>
                                    <div>
                                        审核时间: ${Utils.formatDate(submission.approvedAt)}
                                    </div>
                                </div>
                                
                                ${submission.reviewNote ? `
                                    <div class="bg-gray-50 p-3 rounded-lg text-sm">
                                        <strong>审核备注:</strong> ${submission.reviewNote}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                        
                        container.appendChild(submissionElement);
                    });
                } catch (error) {
                    console.error('加载已通过内容出错:', error);
                }
            },
            
            // 加载已拒绝内容
            loadRejectedSubmissions: function() {
                try {
                    const submissions = AppData.getRejectedSubmissions();
                    const container = document.getElementById('rejectedContainer');
                    const noRejected = document.getElementById('noRejected');
                    
                    container.innerHTML = '';
                    
                    if (submissions.length === 0) {
                        noRejected.classList.remove('hidden');
                        return;
                    }
                    
                    noRejected.classList.add('hidden');
                    
                    submissions.forEach(submission => {
                        const categoryClass = submission.category === 'confession' ? 'bg-confession' : 
                                             submission.category === 'complaint' ? 'bg-complaint' : 'bg-question';
                        
                        const categoryText = submission.category === 'confession' ? '表白墙' : 
                                            submission.category === 'complaint' ? '吐槽区' : '提问区';
                        
                        let imagesHtml = '';
                        if (submission.images && submission.images.length > 0) {
                            imagesHtml = `
                                <div class="grid grid-cols-3 gap-2 mt-3">
                                    ${submission.images.map(img => `
                                        <div class="aspect-square bg-gray-100 rounded-md overflow-hidden">
                                            <img src="${img}" alt="发布图片" class="w-full h-full object-cover">
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                        }
                        
                        const submissionElement = document.createElement('div');
                        submissionElement.className = 'bg-white rounded-xl shadow-sm p-6';
                        submissionElement.innerHTML = `
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center">
                                    <span class="section-indicator ${categoryClass}"></span>
                                    <span class="text-sm font-medium">${categoryText}</span>
                                </div>
                                <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">已拒绝</span>
                            </div>
                            
                            <h3 class="text-lg font-bold mb-3">${submission.title}</h3>
                            
                            <div class="text-gray-700 mb-4">${submission.content}</div>
                            
                            ${imagesHtml}
                            
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <div class="flex justify-between items-center text-sm text-gray-500 mb-3">
                                    <div>
                                        作者: ${submission.authorName}
                                    </div>
                                    <div>
                                        审核时间: ${Utils.formatDate(submission.approvedAt)}
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded-lg text-sm">
                                    <strong>拒绝原因:</strong> ${submission.reviewNote || '未提供原因'}
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(submissionElement);
                    });
                } catch (error) {
                    console.error('加载已拒绝内容出错:', error);
                }
            },
            
            // 渲染帖子列表
            renderPosts: function(category = 'all') {
                try {
                    const postsContainer = document.getElementById('postsContainer');
                    const loadingPosts = document.getElementById('loadingPosts');
                    const noPosts = document.getElementById('noPosts');
                    
                    // 显示加载状态
                    postsContainer.innerHTML = '';
                    loadingPosts.classList.remove('hidden');
                    noPosts.classList.add('hidden');
                    
                    // 模拟加载延迟
                    setTimeout(() => {
                        // 获取已通过的帖子
                        let posts = AppData.getApprovedSubmissions();
                        
                        // 根据分类筛选
                        if (category !== 'all') {
                            posts = posts.filter(post => post.category === category);
                        }
                        
                        // 按时间排序（最新的在前）
                        posts.sort((a, b) => new Date(b.approvedAt) - new Date(a.approvedAt));
                        
                        // 隐藏加载状态
                        loadingPosts.classList.add('hidden');
                        
                        if (posts.length === 0) {
                            noPosts.classList.remove('hidden');
                            return;
                        }
                        
                        // 渲染帖子
                        posts.forEach(post => {
                            const categoryClass = post.category === 'confession' ? 'bg-confession' : 
                                         post.category === 'complaint' ? 'bg-complaint' : 'bg-question';
                            
                            const categoryText = post.category === 'confession' ? '表白墙' : 
                                        post.category === 'complaint' ? '吐槽区' : '提问区';
                            
                            let imagesHtml = '';
                            if (post.images && post.images.length > 0) {
                                imagesHtml = `
                                    <div class="grid grid-cols-3 gap-2 mt-3">
                                        ${post.images.map(img => `
                                            <div class="aspect-square bg-gray-100 rounded-md overflow-hidden">
                                                <img src="${img}" alt="发布图片" class="w-full h-full object-cover">
                                            </div>
                                        `).join('')}
                                    </div>
                                `;
                            }
                            
                            const postElement = document.createElement('div');
                            postElement.className = 'bg-white rounded-xl shadow-sm p-6 card-hover';
                            postElement.innerHTML = `
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex items-center">
                                        <span class="section-indicator ${categoryClass}"></span>
                                        <span class="text-sm font-medium">${categoryText}</span>
                                    </div>
                                    <span class="text-xs text-gray-500">${Utils.formatDate(post.approvedAt)}</span>
                                </div>
                                
                                <h3 class="text-lg font-bold mb-3">${post.title}</h3>
                                
                                <div class="text-gray-700 mb-4">${post.content}</div>
                                
                                ${imagesHtml}
                                
                                <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
                                    <div class="flex items-center">
                                        <img src="${post.authorAvatar || `https://picsum.photos/id/${parseInt(post.authorId.replace('user', '')) + 300}/40/40`}" alt="${post.anonymousRequest ? '匿名用户' : post.authorName}的头像" class="w-6 h-6 rounded-full mr-2">
                                        <span class="text-sm">${post.anonymousRequest ? '匿名用户' : post.authorName}</span>
                                    </div>
                                    <div class="flex space-x-4">
                                        <button class="text-gray-500 hover:text-primary transition-colors text-sm flex items-center">
                                            <i class="fa fa-heart-o mr-1"></i> <span>0</span>
                                        </button>
                                        <button class="text-gray-500 hover:text-primary transition-colors text-sm flex items-center">
                                            <i class="fa fa-comment-o mr-1"></i> <span>0</span>
                                        </button>
                                    </div>
                                </div>
                            `;
                            
                            postsContainer.appendChild(postElement);
                        });
                    }, 800);
                } catch (error) {
                    console.error('渲染帖子出错:', error);
                    Utils.showNotification('加载帖子出错，请重试', true);
                }
            },
            
            // 渲染用户的发布
            renderUserSubmissions: function() {
                try {
                    const submissions = AppData.getUserSubmissions();
                    const container = document.getElementById('mySubmissionsContainer');
                    const noSubmissions = document.getElementById('noSubmissions');
                    
                    container.innerHTML = '';
                    
                    if (submissions.length === 0) {
                        noSubmissions.classList.remove('hidden');
                        return;
                    }
                    
                    noSubmissions.classList.add('hidden');
                    
                    // 按时间排序（最新的在前）
                    submissions.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    
                    submissions.forEach(submission => {
                        const categoryClass = submission.category === 'confession' ? 'bg-confession' : 
                                     submission.category === 'complaint' ? 'bg-complaint' : 'bg-question';
                        
                        const categoryText = submission.category === 'confession' ? '表白墙' : 
                                            submission.category === 'complaint' ? '吐槽区' : '提问区';
                        
                        let statusClass = '';
                        let statusText = '';
                        
                        if (submission.status === 'pending') {
                            statusClass = 'bg-yellow-100 text-yellow-800';
                            statusText = '待审核';
                        } else if (submission.status === 'approved') {
                            statusClass = 'bg-green-100 text-green-800';
                            statusText = '已通过';
                        } else {
                            statusClass = 'bg-red-100 text-red-800';
                            statusText = '已拒绝';
                        }
                        
                        const submissionElement = document.createElement('div');
                        submissionElement.className = 'bg-white rounded-xl shadow-sm p-6 card-hover';
                        submissionElement.innerHTML = `
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center">
                                    <span class="section-indicator ${categoryClass}"></span>
                                    <span class="text-sm font-medium">${categoryText}</span>
                                </div>
                                <span class="text-xs ${statusClass} px-2 py-1 rounded-full">${statusText}</span>
                            </div>
                            
                            <h3 class="text-lg font-bold mb-3">${submission.title}</h3>
                            
                            <div class="text-gray-700 mb-4 line-clamp-2">${submission.content}</div>
                            
                            <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center text-sm text-gray-500">
                                <div>提交时间: ${Utils.formatDate(submission.createdAt)}</div>
                                ${submission.status !== 'pending' ? 
                                    `<div>处理时间: ${Utils.formatDate(submission.approvedAt)}</div>` : ''}
                            </div>
                            
                            ${submission.reviewNote ? `
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg text-sm">
                                    <strong>审核备注:</strong> ${submission.reviewNote}
                                </div>
                            ` : ''}
                        `;
                        
                        container.appendChild(submissionElement);
                    });
                } catch (error) {
                    console.error('渲染用户发布出错:', error);
                }
            },
            
            // 渲染个人资料
            renderProfile: function() {
                try {
                    const currentUser = AppData.currentUser;
                    if (!currentUser) return;
                    
                    const profileAvatar = document.getElementById('profileAvatar');
                    profileAvatar.src = currentUser.avatar || 'https://picsum.photos/id/64/128/128';
                    profileAvatar.alt = currentUser.name + '的头像';
                    
                    document.getElementById('profileName').textContent = currentUser.name;
                    document.getElementById('profilePhone').value = currentUser.phone;
                    document.getElementById('editName').value = currentUser.name;
                    document.getElementById('editBio').value = currentUser.bio || '';
                    document.getElementById('profileJoinDate').textContent = `加入时间: ${currentUser.joinDate}`;
                } catch (error) {
                    console.error('渲染个人资料出错:', error);
                }
            },
            
            // 高亮当前页面链接
            highlightCurrentPage: function() {
                try {
                    // 获取当前URL的哈希部分
                    const hash = window.location.hash || '#home';
                    
                    // 移除所有导航链接的高亮
                    document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
                        link.classList.remove('text-primary', 'font-semibold');
                        link.classList.add('text-dark');
                    });
                    
                    // 高亮当前页面的链接
                    document.querySelectorAll(`.nav-link[href="${hash}"], .mobile-nav-link[href="${hash}"]`).forEach(link => {
                        link.classList.remove('text-dark');
                        link.classList.add('text-primary', 'font-semibold');
                    });
                } catch (error) {
                    console.error('高亮当前页面出错:', error);
                }
            },
            
            // 绑定事件
            bindEvents: function() {
                try {
                    // 导航栏滚动效果
                    window.addEventListener('scroll', () => {
                        const navbar = document.getElementById('navbar');
                        if (window.scrollY > 50) {
                            navbar.classList.add('py-2', 'shadow');
                            navbar.classList.remove('py-3');
                        } else {
                            navbar.classList.add('py-3');
                            navbar.classList.remove('py-2', 'shadow');
                        }
                    });
                    
                    // 移动端菜单切换
                    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                    const mobileMenu = document.getElementById('mobileMenu');
                    
                    if (Utils.elementExists('#mobileMenuBtn') && Utils.elementExists('#mobileMenu')) {
                        mobileMenuBtn.addEventListener('click', () => {
                            mobileMenu.classList.toggle('hidden');
                        });
                    }
                    
                    // 用户下拉菜单
                    const userBtn = document.getElementById('userBtn');
                    const dropdownMenu = document.getElementById('dropdownMenu');
                    
                    if (Utils.elementExists('#userBtn') && Utils.elementExists('#dropdownMenu')) {
                        userBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            dropdownMenu.classList.toggle('hidden');
                        });
                    }
                    
                    // 点击其他地方关闭下拉菜单
                    document.addEventListener('click', () => {
                        if (Utils.elementExists('#dropdownMenu') && !document.getElementById('dropdownMenu').classList.contains('hidden')) {
                            document.getElementById('dropdownMenu').classList.add('hidden');
                        }
                    });
                    
                    // 登录按钮
                    if (Utils.elementExists('#loginBtn')) {
                        document.getElementById('loginBtn').addEventListener('click', () => {
                            Utils.showModal('loginModal');
                        });
                    }
                    
                    if (Utils.elementExists('#mobileLoginBtn')) {
                        document.getElementById('mobileLoginBtn').addEventListener('click', () => {
                            document.getElementById('mobileMenu').classList.add('hidden');
                            Utils.showModal('loginModal');
                        });
                    }
                    
                    if (Utils.elementExists('#submitLoginBtn')) {
                        document.getElementById('submitLoginBtn').addEventListener('click', () => {
                            Utils.showModal('loginModal');
                        });
                    }
                    
                    if (Utils.elementExists('#submissionsLoginBtn')) {
                        document.getElementById('submissionsLoginBtn').addEventListener('click', () => {
                            Utils.showModal('loginModal');
                        });
                    }
                    
                    if (Utils.elementExists('#profileLoginBtn')) {
                        document.getElementById('profileLoginBtn').addEventListener('click', () => {
                            Utils.showModal('loginModal');
                        });
                    }
                    
                    if (Utils.elementExists('#adminLoginBtn')) {
                        document.getElementById('adminLoginBtn').addEventListener('click', () => {
                            Utils.showModal('loginModal');
                        });
                    }
                    
                    // 注册按钮
                    if (Utils.elementExists('#registerBtn')) {
                        document.getElementById('registerBtn').addEventListener('click', () => {
                            Utils.showModal('registerModal');
                        });
                    }
                    
                    if (Utils.elementExists('#mobileRegisterBtn')) {
                        document.getElementById('mobileRegisterBtn').addEventListener('click', () => {
                            document.getElementById('mobileMenu').classList.add('hidden');
                            Utils.showModal('registerModal');
                        });
                    }
                    
                    // 关闭模态框
                    if (Utils.elementExists('#closeLoginModal')) {
                        document.getElementById('closeLoginModal').addEventListener('click', () => {
                            Utils.hideModal('loginModal');
                        });
                    }
                    
                    if (Utils.elementExists('#closeRegisterModal')) {
                        document.getElementById('closeRegisterModal').addEventListener('click', () => {
                            Utils.hideModal('registerModal');
                        });
                    }
                    
                    if (Utils.elementExists('#closeForgotPasswordModal')) {
                        document.getElementById('closeForgotPasswordModal').addEventListener('click', () => {
                            Utils.hideModal('forgotPasswordModal');
                        });
                    }
                    
                    // 点击模态框外部关闭
                    if (Utils.elementExists('#loginModal')) {
                        document.getElementById('loginModal').addEventListener('click', (e) => {
                            if (e.target === document.getElementById('loginModal')) {
                                Utils.hideModal('loginModal');
                            }
                        });
                    }
                    
                    if (Utils.elementExists('#registerModal')) {
                        document.getElementById('registerModal').addEventListener('click', (e) => {
                            if (e.target === document.getElementById('registerModal')) {
                                Utils.hideModal('registerModal');
                            }
                        });
                    }
                    
                    if (Utils.elementExists('#forgotPasswordModal')) {
                        document.getElementById('forgotPasswordModal').addEventListener('click', (e) => {
                            if (e.target === document.getElementById('forgotPasswordModal')) {
                                Utils.hideModal('forgotPasswordModal');
                            }
                        });
                    }
                    
                    // 切换登录/注册
                    if (Utils.elementExists('#switchToRegister')) {
                        document.getElementById('switchToRegister').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.hideModal('loginModal');
                            setTimeout(() => {
                                Utils.showModal('registerModal');
                            }, 300);
                        });
                    }
                    
                    if (Utils.elementExists('#switchToLogin')) {
                        document.getElementById('switchToLogin').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.hideModal('registerModal');
                            setTimeout(() => {
                                Utils.showModal('loginModal');
                            }, 300);
                        });
                    }
                    
                    // 忘记密码相关
                    if (Utils.elementExists('#forgotPasswordBtn')) {
                        document.getElementById('forgotPasswordBtn').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.hideModal('loginModal');
                            setTimeout(() => {
                                Utils.showModal('forgotPasswordModal');
                            }, 300);
                        });
                    }
                    
                    if (Utils.elementExists('#backToLoginFromForgot')) {
                        document.getElementById('backToLoginFromForgot').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.hideModal('forgotPasswordModal');
                            setTimeout(() => {
                                Utils.showModal('loginModal');
                            }, 300);
                        });
                    }
                    
                    // 验证码刷新
                    if (Utils.elementExists('#refreshLoginCaptcha')) {
                        document.getElementById('refreshLoginCaptcha').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.updateCaptcha('loginCaptchaImage', 'loginCaptchaCode');
                        });
                    }
                    
                    if (Utils.elementExists('#refreshRegisterCaptcha')) {
                        document.getElementById('refreshRegisterCaptcha').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.updateCaptcha('registerCaptchaImage', 'registerCaptchaCode');
                        });
                    }
                    
                    if (Utils.elementExists('#refreshForgotCaptcha')) {
                        document.getElementById('refreshForgotCaptcha').addEventListener('click', (e) => {
                            e.preventDefault();
                            Utils.updateCaptcha('forgotCaptchaImage', 'forgotCaptchaCode');
                        });
                    }
                    
                    // 登录表单提交
                    if (Utils.elementExists('#loginForm')) {
                        document.getElementById('loginForm').addEventListener('submit', (e) => {
                            e.preventDefault();
                            const phone = document.getElementById('loginPhone').value;
                            const password = document.getElementById('loginPassword').value;
                            const captchaInput = document.getElementById('loginCaptcha').value;
                            const captchaCode = document.getElementById('loginCaptchaCode').textContent;
                            
                            // 简单验证
                            if (!phone || !password || !captchaInput) {
                                Utils.showNotification('请填写完整信息', true);
                                return;
                            }
                            
                            const result = AppData.login(phone, password, captchaInput, captchaCode);
                            if (result.success) {
                                Utils.hideModal('loginModal');
                                Utils.clearForm('loginForm');
                                // 刷新验证码
                                Utils.updateCaptcha('loginCaptchaImage', 'loginCaptchaCode');
                                this.updatePageState();
                                this.renderPosts();
                                Utils.showNotification('登录成功');
                            } else {
                                // 验证失败时刷新验证码
                                Utils.updateCaptcha('loginCaptchaImage', 'loginCaptchaCode');
                                Utils.showNotification(result.message, true);
                            }
                        });
                    }
                    
                    // 注册表单提交
                    if (Utils.elementExists('#registerForm')) {
                        document.getElementById('registerForm').addEventListener('submit', (e) => {
                            e.preventDefault();
                            const phone = document.getElementById('registerPhone').value;
                            const name = document.getElementById('registerName').value;
                            const password = document.getElementById('registerPassword').value;
                            const captchaInput = document.getElementById('registerCaptcha').value;
                            const captchaCode = document.getElementById('registerCaptchaCode').textContent;
                            
                            // 简单验证
                            if (!phone || !name || !password || !captchaInput) {
                                Utils.showNotification('请填写完整信息', true);
                                return;
                            }
                            
                            if (password.length < 6) {
                                Utils.showNotification('密码长度不能少于6位', true);
                                return;
                            }
                            
                            const result = AppData.register({ phone, name, password }, captchaInput, captchaCode);
                            if (result.success) {
                                Utils.hideModal('registerModal');
                                Utils.clearForm('registerForm');
                                // 刷新验证码
                                Utils.updateCaptcha('registerCaptchaImage', 'registerCaptchaCode');
                                this.updatePageState();
                                this.renderPosts();
                                Utils.showNotification('注册成功');
                            } else {
                                // 验证失败时刷新验证码
                                Utils.updateCaptcha('registerCaptchaImage', 'registerCaptchaCode');
                                Utils.showNotification(result.message, true);
                            }
                        });
                    }
                    
                    // 忘记密码表单提交
                    if (Utils.elementExists('#forgotPasswordForm')) {
                        document.getElementById('forgotPasswordForm').addEventListener('submit', (e) => {
                            e.preventDefault();
                            const phone = document.getElementById('forgotPhone').value;
                            const newPassword = document.getElementById('newPassword').value;
                            const captchaInput = document.getElementById('forgotCaptcha').value;
                            const captchaCode = document.getElementById('forgotCaptchaCode').textContent;
                            
                            // 简单验证
                            if (!phone || !newPassword || !captchaInput) {
                                Utils.showNotification('请填写完整信息', true);
                                return;
                            }
                            
                            if (newPassword.length < 6) {
                                Utils.showNotification('密码长度不能少于6位', true);
                                return;
                            }
                            
                            const result = AppData.resetPassword(phone, newPassword, captchaInput, captchaCode);
                            if (result.success) {
                                Utils.hideModal('forgotPasswordModal');
                                Utils.clearForm('forgotPasswordForm');
                                // 刷新验证码
                                Utils.updateCaptcha('forgotCaptchaImage', 'forgotCaptchaCode');
                                // 显示登录模态框
                                setTimeout(() => {
                                    Utils.showModal('loginModal');
                                }, 300);
                                Utils.showNotification(result.message);
                            } else {
                                // 验证失败时刷新验证码
                                Utils.updateCaptcha('forgotCaptchaImage', 'forgotCaptchaCode');
                                Utils.showNotification(result.message, true);
                            }
                        });
                    }
                    
                    // 登出
                    if (Utils.elementExists('#logoutBtn')) {
                        document.getElementById('logoutBtn').addEventListener('click', (e) => {
                            e.preventDefault();
                            AppData.logout();
                            this.updatePageState();
                            this.renderPosts();
                            Utils.showNotification('已退出登录');
                        });
                    }
                    
                    if (Utils.elementExists('#mobileLogoutBtn')) {
                        document.getElementById('mobileLogoutBtn').addEventListener('click', (e) => {
                            e.preventDefault();
                            document.getElementById('mobileMenu').classList.add('hidden');
                            AppData.logout();
                            this.updatePageState();
                            this.renderPosts();
                            Utils.showNotification('已退出登录');
                        });
                    }
                    
                    // 发布内容表单提交
                    if (Utils.elementExists('#submissionForm')) {
                        document.getElementById('submissionForm').addEventListener('submit', (e) => {
                            e.preventDefault();
                            const title = document.getElementById('submissionTitle').value;
                            const category = document.getElementById('submissionCategory').value;
                            const content = document.getElementById('submissionContent').value;
                            const anonymousRequest = document.getElementById('anonymousRequest').checked;
                            
                            // 获取预览图片
                            const previewImages = document.querySelectorAll('#imagePreviewContainer img');
                            const images = Array.from(previewImages).map(img => img.src);
                            
                            // 简单验证
                            if (!title || !content) {
                                Utils.showNotification('请填写标题和内容', true);
                                return;
                            }
                            
                            const result = AppData.submitContent({
                                title,
                                category,
                                content,
                                images,
                                anonymousRequest
                            });
                            
                            if (result.success) {
                                // 重置表单
                                Utils.clearForm('submissionForm');
                                document.getElementById('imagePreviewContainer').innerHTML = '';
                                
                                // 显示成功提示
                                document.getElementById('submissionForm').classList.add('hidden');
                                document.getElementById('submissionSuccess').classList.remove('hidden');
                                
                                // 刷新我的发布
                                this.renderUserSubmissions();
                            } else {
                                Utils.showNotification(result.message, true);
                            }
                        });
                    }
                    
                    // 再发布一条
                    if (Utils.elementExists('#submitAnotherBtn')) {
                        document.getElementById('submitAnotherBtn').addEventListener('click', () => {
                            document.getElementById('submissionSuccess').classList.add('hidden');
                            document.getElementById('submissionForm').classList.remove('hidden');
                        });
                    }
                    
                    // 图片上传预览
                    if (Utils.elementExists('#imageUpload')) {
                        document.getElementById('imageUpload').addEventListener('change', (e) => {
                            const files = e.target.files;
                            const container = document.getElementById('imagePreviewContainer');
                            
                            // 最多上传3张图片
                            if (container.children.length + files.length > 3) {
                                Utils.showNotification('最多只能上传3张图片', true);
                                return;
                            }
                            
                            Array.from(files).forEach(file => {
                                const reader = new FileReader();
                                
                                reader.onload = (event) => {
                                    const previewDiv = document.createElement('div');
                                    previewDiv.className = 'image-preview';
                                    previewDiv.innerHTML = `
                                        <img src="${event.target.result}" alt="预览图片">
                                        <span class="remove-image" data-index="${container.children.length}">×</span>
                                    `;
                                    
                                    container.appendChild(previewDiv);
                                    
                                    // 绑定删除图片事件
                                    previewDiv.querySelector('.remove-image').addEventListener('click', function() {
                                        previewDiv.remove();
                                        // 重新索引
                                        document.querySelectorAll('.remove-image').forEach((el, index) => {
                                            el.setAttribute('data-index', index);
                                        });
                                    });
                                };
                                
                                reader.readAsDataURL(file);
                            });
                            
                            // 重置input，允许重复选择同一文件
                            e.target.value = '';
                        });
                    }
                    
                    // 板块切换
                    if (Utils.elementExists('#allPostsBtn')) {
                        document.getElementById('allPostsBtn').addEventListener('click', () => {
                            this.setActiveTab('allPostsBtn');
                            this.renderPosts('all');
                        });
                    }
                    
                    if (Utils.elementExists('#confessionBtn')) {
                        document.getElementById('confessionBtn').addEventListener('click', () => {
                            this.setActiveTab('confessionBtn');
                            this.renderPosts('confession');
                        });
                    }
                    
                    if (Utils.elementExists('#complaintBtn')) {
                        document.getElementById('complaintBtn').addEventListener('click', () => {
                            this.setActiveTab('complaintBtn');
                            this.renderPosts('complaint');
                        });
                    }
                    
                    if (Utils.elementExists('#questionBtn')) {
                        document.getElementById('questionBtn').addEventListener('click', () => {
                            this.setActiveTab('questionBtn');
                            this.renderPosts('question');
                        });
                    }
                    
                    // 审核标签页切换
                    if (Utils.elementExists('#pendingReviewsBtn')) {
                        document.getElementById('pendingReviewsBtn').addEventListener('click', () => {
                            this.setActiveAdminTab('pendingReviewsBtn');
                            document.getElementById('pendingReviewsContainer').classList.remove('hidden');
                            document.getElementById('approvedContainer').classList.add('hidden');
                            document.getElementById('rejectedContainer').classList.add('hidden');
                        });
                    }
                    
                    if (Utils.elementExists('#approvedBtn')) {
                        document.getElementById('approvedBtn').addEventListener('click', () => {
                            this.setActiveAdminTab('approvedBtn');
                            document.getElementById('pendingReviewsContainer').classList.add('hidden');
                            document.getElementById('approvedContainer').classList.remove('hidden');
                            document.getElementById('rejectedContainer').classList.add('hidden');
                            this.loadApprovedSubmissions();
                        });
                    }
                    
                    if (Utils.elementExists('#rejectedBtn')) {
                        document.getElementById('rejectedBtn').addEventListener('click', () => {
                            this.setActiveAdminTab('rejectedBtn');
                            document.getElementById('pendingReviewsContainer').classList.add('hidden');
                            document.getElementById('approvedContainer').classList.add('hidden');
                            document.getElementById('rejectedContainer').classList.remove('hidden');
                            this.loadRejectedSubmissions();
                        });
                    }
                    
                    // 加载更多按钮
                    if (Utils.elementExists('#loadMoreBtn')) {
                        document.getElementById('loadMoreBtn').addEventListener('click', () => {
                            // 实际应用中这里会加载更多内容
                            Utils.showNotification('已加载全部内容');
                        });
                    }
                    
                    // 个人资料表单提交
                    if (Utils.elementExists('#profileForm')) {
                        document.getElementById('profileForm').addEventListener('submit', (e) => {
                            e.preventDefault();
                            const name = document.getElementById('editName').value;
                            const bio = document.getElementById('editBio').value;
                            const password = document.getElementById('editPassword').value;
                            
                            // 简单验证
                            if (!name) {
                                Utils.showNotification('请输入姓名', true);
                                return;
                            }
                            
                            if (password && password.length < 6) {
                                Utils.showNotification('密码长度不能少于6位', true);
                                return;
                            }
                            
                            const result = AppData.updateProfile({ name, bio, password });
                            if (result.success) {
                                this.renderProfile();
                                // 更新导航栏中的用户名和头像
                                document.getElementById('usernameDisplay').textContent = name;
                                document.getElementById('mobileUsername').textContent = name;
                                Utils.showNotification('资料更新成功');
                            } else {
                                Utils.showNotification(result.message, true);
                            }
                        });
                    }
                    
                    // 头像上传
                    if (Utils.elementExists('#avatarUpload')) {
                        document.getElementById('avatarUpload').addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (!file) return;
                            
                            // 检查文件类型
                            if (!file.type.startsWith('image/')) {
                                Utils.showNotification('请选择图片文件', true);
                                return;
                            }
                            
                            // 检查文件大小（5MB以内）
                            if (file.size > 5 * 1024 * 1024) {
                                Utils.showNotification('图片大小不能超过5MB', true);
                                return;
                            }
                            
                            const reader = new FileReader();
                            
                            reader.onload = (event) => {
                                const result = AppData.updateProfile({ avatar: event.target.result });
                                if (result.success) {
